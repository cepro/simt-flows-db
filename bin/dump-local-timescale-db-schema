#!/bin/sh

DUMP_FILE=/db/timescale-local-`date +%s`.sql
HOST_DIR=`pwd`/dumps

docker run \
        --rm -it \
        --network host \
        -v $HOST_DIR:/db postgres:17-alpine \
    pg_dump \
        --host 0.0.0.0 \
        --port 15432 \
        --dbname=postgres \
        --username=postgres \
        --file=$DUMP_FILE \
        --schema=public \
        --schema=flows \
        --clean --if-exists --schema-only --no-privileges

echo "Dumped to $HOST_DIR/`basename $DUMP_FILE`"
